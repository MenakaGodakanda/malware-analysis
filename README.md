# Malware Analysis Project

This project provides tools for analyzing malware samples. It includes scripts for extracting IOC and reverse engineering malware code.<br>
<a href="https://github.com/MenakaGodakanda/malware-analysis/blob/main/Project_Description.md">Project Description</a>

## Overview

<img width="1002" alt="Screenshot 2024-06-28 at 4 04 33 PM" src="https://github.com/MenakaGodakanda/malware-analysis/assets/156875412/357cecb4-af27-4329-9609-8402994da066">

### Explanation

- **Sample File**:
  - **sample.exe**: Malware sample that requires to be analyzed.

- **Scripts**:
  - **extract_iocs.py**: Analyzes PE files and writes results to iocs.json.
  - **reverse_engineer.py**: Uses Radare2 to perform static analysis, writing results to reverse_engineer.txt.

- **Tools**:
  - **PEfile**: A Python module to analyze Portable Executable (PE) files.
  - **Radare2**: Used for reverse engineering the sample.

- **Reports**:
  - **iocs.json**: Contains the output of the analysis performed by extract_iocs.py.
  - **reverse_engineer.txt**: Contains the output of the analysis performed by reverse_engineer.py.


## Installation

Use a Linux distribution, such as Ubuntu, for better compatibility with open-source malware analysis tools.

1. Clone the repository.
```
git clone https://github.com/MenakaGodakanda/malware-analysis.git
cd malware-analysis
```

2. Set up a Python virtual environment.

- Python: Ensure Python 3.x is installed.
- Virtual Environment: Use `venv` to create a virtual environment for your project.

```
sudo apt update
sudo apt install python3 python3-venv python3-pip
python3 -m venv malware-env
source malware-env/bin/activate
```
![Screenshot 2024-06-29 075027](https://github.com/MenakaGodakanda/malware-analysis/assets/156875412/b477c30b-4a30-4b57-9e7a-c6979bf0db3e)

3. Install required tools and dependencies.

- PEfile: A Python module to analyze Portable Executable (PE) files.
```bash
pip install pefile
```
![Screenshot 2024-06-28 162334](https://github.com/MenakaGodakanda/malware-analysis/assets/156875412/0ddd4057-3c08-49c1-b0b0-097f84496fe2)

- Radare2: A reverse engineering framework.
  - Install Dependencies:
  ```bash
  sudo apt install git build-essential
  ```
  - Clone the Radare2 Repository:
  ```bash
  git clone https://github.com/radareorg/radare2.git
  ```
  
  - Navigate to the Cloned Directory:
  ```bash
  cd radare2
  ```
  
  - Run the Installation Script:
  ```bash
  ./sys/install.sh
  ```
  
  - After the installation completes, you can verify that Radare2 is installed correctly by checking its version:
  ```bash
  r2 -v
  ```
![Screenshot 2024-06-28 162141](https://github.com/MenakaGodakanda/malware-analysis/assets/156875412/ed9c2505-5471-4242-8f55-37c804ce66f6)

### Obtain Malware Sample Safely

For a project involving malware analysis, it's essential to handle real malware samples with extreme caution. Downloading and working with real malware can be dangerous and should only be done in a controlled, isolated environment such as a virtual machine specifically set up for malware analysis.

#### Malware Sample Source

Here are some reputable sources where you can obtain malware samples for analysis:

1. TheZoo:
- TheZoo is a live malware repository maintained by the community.
- GitHub Repository: https://github.com/ytisf/theZoo

2. MalwareBazaar:
- MalwareBazaar is a project from abuse.ch aimed at sharing malware samples with the security community.
- Website: https://bazaar.abuse.ch/

3. VirusShare:
- VirusShare is a private repository where you can find various malware samples.
- Website: https://virusshare.com/

4. Any.Run:
- Any.Run is an interactive malware analysis sandbox. You can find samples and also run them in a sandbox environment.
- Website: https://any.run/

5. VX Underground:
- VX Underground is a platform that provides a large collection of malware samples for research purposes.
- Website: https://vx-underground.org/

#### Setting Up a Safe Environment

1. Virtual Machine (VM):
- Use a virtual machine to create an isolated environment for malware analysis. Tools like VMware Workstation, VirtualBox, or Hyper-V can be used.
- Install a fresh copy of your preferred operating system in the VM.
- Ensure the VM has no network access or is connected to a segregated network to prevent accidental spread of malware.

2. Snapshot Management:
- Take a snapshot of the VM before downloading or running any malware. This allows you to revert to a clean state if the system is compromised.

3. Dedicated Tools:
- Install only the necessary tools for malware analysis in the VM (e.g., PEfile, YARA, Radare2, Cuckoo Sandbox).

#### Example of Obtaining a Sample from TheZoo

If you choose to use TheZoo, follow these steps to download a sample:

1. Clone TheZoo Repository:
```bash
git clone https://github.com/ytisf/theZoo.git
cd theZoo
```

2. Navigate to the Malware Sample:
Find a sample you are interested in. For example, to get a sample of the `WannaCry` ransomware:
```bash
cd malware/Binaries/WannaCry
```

3. Download the Sample:
Follow the instructions provided in the repository to download and extract the sample. Note that the samples are usually password-protected (password: `infected`).

#### Using the Sample in Your Project

1. Place the Sample in the `samples/` Directory:
After downloading and extracting the sample, move it to the samples/ directory in your project.
```bash
mv path_to_sample.exe malware-analysis/samples/sample.exe
```

2. Run the Scripts:
Execute your scripts to analyze the sample. Ensure you are running these scripts within the VM.

## Usage

For the demonstration, the sample of the `WannaCry` ransomware is placed in the sample directory as `sample.exe`.

### Extract IOCs
```bash
python scripts/extract_iocs.py
```
![Screenshot 2024-06-28 145226](https://github.com/MenakaGodakanda/malware-analysis/assets/156875412/2500a611-84dc-4fe6-aea9-92695e8de25d)

### Reverse Engineer
```bash
python scripts/reverse_engineer.py
```

The output should look like this:<br>
![Screenshot 2024-06-28 144808](https://github.com/MenakaGodakanda/malware-analysis/assets/156875412/4e8f64fe-98fa-43bb-8bfe-6752c862ebf8)

### Output

After running the scripts, the generated reports will be saved in the `reports` directory for documentation and further analysis. <br><br>
![Screenshot 2024-06-30 173916](https://github.com/MenakaGodakanda/malware-analysis/assets/156875412/88800123-147a-4872-84bd-5ad2c102aa91)

## Directory Structure

```
malware-analysis/
├── samples/
│   └── sample.exe              # Contains malware sample files.
├── scripts/
│   ├── extract_iocs.py         # Contains analysis scripts.
│   └── reverse_engineer.py
├── reports/                    # Stores analysis reports.
│   ├── iocs.json
│   └── reverse_engineer.txt
└── README.md
```

## Disclaimer

- **Legal and Ethical Considerations**: Ensure you have the right to download and use the malware samples. Only use them for educational and research purposes.
- **Safety Precautions**: Always handle malware in a controlled and isolated environment to prevent accidental infection of your host system or network.

## License

This project is licensed under the MIT License.
